<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Iron Man Mode - Multi Game Random Picker</title>
  <style>
    /* Basic Styling */
    body { font-family: Arial, sans-serif; text-align: center; background: #1c1c1c; color: #fff; margin: 0; padding: 20px; }
    #start-screen, #main-app, #congrats-screen { display: none; }
    #start-screen.active, #main-app.active { display: block; }
    select, button { padding: 10px 15px; margin: 10px; font-size: 16px; border-radius: 5px; border: none; }
    #available-grid, #selected-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; margin-bottom: 30px; }
    .character { background: #333; padding: 10px; border-radius: 10px; cursor: pointer; transition: transform 0.2s, opacity 0.3s; user-select: none; }
    .character:hover { transform: scale(1.05); }
    .character img { width: 100%; height: auto; border-radius: 8px; pointer-events: none; }
    .selected { background: #555; opacity: 0.6; }
    #popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000; text-align: center; width: 300px; }
    #popup img { width: 100px; height: 100px; object-fit: cover; margin-bottom: 10px; border-radius: 8px; border: 3px solid #00BFFF; padding: 5px; background: white; }
    #popup-buttons { margin-top: 20px; }
    .popup-btn { padding: 10px 15px; margin: 5px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; }
    .reset-btn { background-color: #e74c3c; color: white; }
    .continue-btn { background-color: #3498db; color: white; }
    .close-btn { background-color: #f1c40f; color: black; }
  </style>
</head>
<body>

<!-- Start Screen -->
<div id="start-screen" class="active">
  <h1>Choose Genre and Game</h1>

  <select id="genre-select">
    <option value="">-- Select Genre --</option>
    <option value="platform">Platform Fighters</option>
    <option value="2d">2D Fighters</option>
    <option value="3d">3D Fighters</option>
  </select><br>

  <select id="game-select" disabled>
    <option value="">-- Select Game --</option>
  </select><br>

  <button id="start-button" disabled>Start</button>
</div>

<!-- Main App -->
<div id="main-app">
  <h1>Iron Man Mode</h1>

  <div id="controls">
    <button id="random-pick">Random Pick</button>
    <button id="reset-characters">Reset Characters</button>
    <button id="back-to-selection">Back to Selection</button> <!-- ðŸ”¥ New button -->
    <div id="percentage"></div>
  </div>

  <h2>Available Characters</h2>
  <div id="available-grid"></div>

  <h2>Selected Characters</h2>
  <div id="selected-grid"></div>

  <div id="popup">
    <img id="popup-img" src="" alt="Character">
    <h2 id="popup-name"></h2>
    <p id="popup-progress"></p>
    <div id="popup-buttons">
      <button class="popup-btn reset-btn" id="reset-go">Reset & Go</button>
      <button class="popup-btn continue-btn" id="continue">Continue</button>
      <button class="popup-btn close-btn" id="close">Close</button>
    </div>
  </div>
</div>

<!-- Congrats Screen -->
<div id="congrats-screen">
  <h1>ðŸŽ‰ Congratulations! ðŸŽ‰</h1>
  <p>You have completed the Iron Man challenge!</p>
  <button id="restart-button">Play Again</button>
</div>

<!-- JavaScript -->
<script>
// --- Data ---
const allGames = {
  ssb64: { name: "Super Smash Bros. 64", genre: "platform", roster: ["Luigi.png", "Mario.png", "Donkey Kong.png", "Link.png", "Samus.png", "Captain Falcon.png", "Ness.png", "Yoshi.png", "Kirby.png", "Fox.png", "Pikachu.png", "Jigglypuff.png"] },
  ssf2: { name: "Super Smash Flash 2", genre: "platform", roster: ["naruto.png", "goku.png", "ichigo.png", "megaman.png"] },
  streetfighter2: { name: "Street Fighter 2", genre: "2d", roster: ["ryu.png", "ken.png", "chunli.png", "guile.png"] }
};

// --- Elements ---
const genreSelect = document.getElementById('genre-select');
const gameSelect = document.getElementById('game-select');
const startButton = document.getElementById('start-button');
const startScreen = document.getElementById('start-screen');
const mainApp = document.getElementById('main-app');
const congratsScreen = document.getElementById('congrats-screen');
const availableGrid = document.getElementById('available-grid');
const selectedGrid = document.getElementById('selected-grid');
const randomPickButton = document.getElementById('random-pick');
const resetCharactersButton = document.getElementById('reset-characters');
const backToSelectionButton = document.getElementById('back-to-selection'); // <-- new
const percentageDisplay = document.getElementById('percentage');
const popup = document.getElementById('popup');
const popupImg = document.getElementById('popup-img');
const popupName = document.getElementById('popup-name');
const popupProgress = document.getElementById('popup-progress');
const resetGoBtn = document.getElementById('reset-go');
const continueBtn = document.getElementById('continue');
const closeBtn = document.getElementById('close');
const restartButton = document.getElementById('restart-button');

let pickedCharacter = null;
let currentRoster = [];
let currentGame = "";

function updatePercentage() {
  const total = availableGrid.children.length + selectedGrid.children.length;
  const remaining = availableGrid.children.length;
  const percentage = total === 0 ? 0 : (remaining / total * 100).toFixed(1);
  percentageDisplay.textContent = `${percentage}% Characters Remaining`;
}

function checkCompletion() {
  if (availableGrid.children.length === 0) {
    mainApp.classList.remove('active');
    congratsScreen.style.display = 'block';
    popup.style.display = 'none';
  }
}

function moveCharacterOneWay(character) {
  if (availableGrid.contains(character)) {
    availableGrid.removeChild(character);
    character.classList.add('selected');
    selectedGrid.appendChild(character);
  }
  updatePercentage();
  checkCompletion();
}

function pickRandomCharacter() {
  const availableCharacters = Array.from(availableGrid.children);
  if (availableCharacters.length === 0) {
    popup.style.display = 'none';
    alert("No characters left to pick!");
    return;
  }
  const randomIndex = Math.floor(Math.random() * availableCharacters.length);
  pickedCharacter = availableCharacters[randomIndex];

  const img = pickedCharacter.querySelector('img');
  popupImg.src = img.src;
  popupName.textContent = pickedCharacter.getAttribute('data-name') || img.alt;

  const total = availableGrid.children.length + selectedGrid.children.length;
  const completed = selectedGrid.children.length + 1;
  const percentage = total === 0 ? 0 : (completed / total * 100).toFixed(1);
  popupProgress.textContent = `${completed}/${total} (${percentage}%)`;

  popup.style.display = 'block';
}

function resetCharacterLists() {
  availableGrid.innerHTML = '';
  selectedGrid.innerHTML = '';
  currentRoster.forEach(file => {
    const name = file.replace('.png', '').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    const div = document.createElement('div');
    div.className = 'character';
    div.setAttribute('data-name', name);
    div.innerHTML = `<img src="Images/${currentGame}/${file}" alt="${name}">`;
    div.addEventListener('click', () => {
      moveCharacterOneWay(div);
    });
    availableGrid.appendChild(div);
  });
  updatePercentage();
}

// --- Event Listeners ---
genreSelect.addEventListener('change', () => {
  const selectedGenre = genreSelect.value;
  gameSelect.innerHTML = '<option value="">-- Select Game --</option>';

  if (selectedGenre) {
    for (const [key, game] of Object.entries(allGames)) {
      if (game.genre === selectedGenre) {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = game.name;
        gameSelect.appendChild(option);
      }
    }
    gameSelect.disabled = false;
  } else {
    gameSelect.disabled = true;
  }

  startButton.disabled = true;
});

gameSelect.addEventListener('change', () => {
  startButton.disabled = gameSelect.value === "";
});

startButton.addEventListener('click', () => {
  currentGame = gameSelect.value;
  currentRoster = allGames[currentGame]?.roster || [];

  resetCharacterLists();
  startScreen.classList.remove('active');
  mainApp.classList.add('active');
});

randomPickButton.addEventListener('click', pickRandomCharacter);

resetGoBtn.addEventListener('click', () => {
  resetCharacterLists();
  updatePercentage();
});

continueBtn.addEventListener('click', () => {
  if (pickedCharacter) moveCharacterOneWay(pickedCharacter);
  pickRandomCharacter();
});

closeBtn.addEventListener('click', () => {
  popup.style.display = 'none';
});

resetCharactersButton.addEventListener('click', () => {
  resetCharacterLists();
});

backToSelectionButton.addEventListener('click', () => {
  mainApp.classList.remove('active');
  startScreen.classList.add('active');

  availableGrid.innerHTML = '';
  selectedGrid.innerHTML = '';
  popup.style.display = 'none';
  
  genreSelect.value = "";
  gameSelect.innerHTML = '<option value="">-- Select Game --</option>';
  gameSelect.disabled = true;
  startButton.disabled = true;
  
  percentageDisplay.textContent = "";
});

restartButton.addEventListener('click', () => {
  congratsScreen.style.display = 'none';
  startScreen.classList.add('active');
  genreSelect.value = "";
  gameSelect.disabled = true;
  startButton.disabled = true;
});
</script>

</body>
</html>
